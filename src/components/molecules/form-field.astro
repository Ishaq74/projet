---
// Form Field molecule component that combines label, input, and helper text
import Input from '../atoms/input.astro';
import Icon from '../atoms/icon.astro';

export interface Props {
  label?: string;
  name: string;
  type?: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url' | 'search';
  placeholder?: string;
  value?: string;
  required?: boolean;
  disabled?: boolean;
  readonly?: boolean;
  autocomplete?: string;
  helperText?: string;
  errorText?: string;
  successText?: string;
  size?: 'sm' | 'md' | 'lg';
  fullWidth?: boolean;
  showLabel?: boolean;
  class?: string;
}

const {
  label,
  name,
  type = 'text',
  placeholder,
  value,
  required = false,
  disabled = false,
  readonly = false,
  autocomplete,
  helperText,
  errorText,
  successText,
  size = 'md',
  fullWidth = true,
  showLabel = true,
  class: className = '',
} = Astro.props;

const fieldId = `field-${name}`;
const helperId = helperText ? `helper-${name}` : undefined;
const errorId = errorText ? `error-${name}` : undefined;

const variant = errorText ? 'error' : successText ? 'success' : 'default';

const classes = [
  'form-field',
  `form-field--${size}`,
  fullWidth && 'form-field--full-width',
  className
].filter(Boolean).join(' ');
---

<div class={classes}>
  {showLabel && label && (
    <label class="form-field__label" for={fieldId}>
      {label}
      {required && <span class="form-field__required" aria-label="required">*</span>}
    </label>
  )}
  
  <div class="form-field__input-wrapper">
    <Input
      id={fieldId}
      name={name}
      type={type}
      placeholder={placeholder}
      value={value}
      required={required}
      disabled={disabled}
      readonly={readonly}
      autocomplete={autocomplete}
      variant={variant}
      size={size}
      fullWidth={fullWidth}
      aria-describedby={[helperId, errorId].filter(Boolean).join(' ') || undefined}
    />
    
    {successText && (
      <div class="form-field__icon form-field__icon--success">
        <Icon name="check" size="sm" color="success" decorative={true} />
      </div>
    )}
    
    {errorText && (
      <div class="form-field__icon form-field__icon--error">
        <Icon name="alert-circle" size="sm" color="error" decorative={true} />
      </div>
    )}
  </div>
  
  {helperText && (
    <div class="form-field__helper" id={helperId}>
      {helperText}
    </div>
  )}
  
  {errorText && (
    <div class="form-field__error" id={errorId} role="alert">
      {errorText}
    </div>
  )}
  
  {successText && (
    <div class="form-field__success">
      {successText}
    </div>
  )}
</div>

<style>
  .form-field {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .form-field--full-width {
    width: 100%;
  }

  .form-field__label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--text-primary);
    margin-bottom: var(--space-1);
  }

  .form-field__required {
    color: var(--color-error-600);
    margin-left: var(--space-1);
  }

  .form-field__input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .form-field__icon {
    position: absolute;
    right: var(--space-3);
    pointer-events: none;
    z-index: 1;
  }

  .form-field__icon--success {
    color: var(--color-success-600);
  }

  .form-field__icon--error {
    color: var(--color-error-600);
  }

  .form-field__helper {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    line-height: var(--line-height-normal);
  }

  .form-field__error {
    font-size: var(--font-size-sm);
    color: var(--color-error-600);
    line-height: var(--line-height-normal);
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .form-field__success {
    font-size: var(--font-size-sm);
    color: var(--color-success-600);
    line-height: var(--line-height-normal);
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  /* Size variants */
  .form-field--sm {
    gap: var(--space-1);
  }

  .form-field--sm .form-field__label {
    font-size: var(--font-size-xs);
  }

  .form-field--sm .form-field__helper,
  .form-field--sm .form-field__error,
  .form-field--sm .form-field__success {
    font-size: var(--font-size-xs);
  }

  .form-field--lg {
    gap: var(--space-3);
  }

  .form-field--lg .form-field__label {
    font-size: var(--font-size-base);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .form-field__icon {
      right: var(--space-4);
    }
  }
</style>