---
// Individual Restaurant Page
import Layout from '../../../../layouts/Layout.astro';
import Navigation from '../../../../components/Navigation.astro';
import { loadTranslations, t, locales } from '../../../../utils/i18n';
import type { Locale } from '../../../../types/i18n';

export async function getStaticPaths() {
  // Mock restaurant data
  const restaurants = [
    {
      slug: "le-palace-du-lac",
      category: "gastronomique",
      name: "Le Palace du Lac",
      description: "Restaurant gastronomique avec vue sur le lac d'Annecy",
      address: "2 Avenue du Rh√¥ne, 74000 Annecy",
      rating: 4.5,
      priceRange: "‚Ç¨‚Ç¨‚Ç¨‚Ç¨",
      cuisine: "Fran√ßaise",
      phone: "04 50 45 12 34",
      email: "contact@palace-du-lac.fr",
      website: "https://palace-du-lac.fr",
      image: "/images/restaurants/palace-lac.jpg",
      gallery: [
        "/images/restaurants/palace-lac-1.jpg",
        "/images/restaurants/palace-lac-2.jpg",
        "/images/restaurants/palace-lac-3.jpg"
      ],
      features: ["Vue sur lac", "Terrasse", "Parking", "R√©servation recommand√©e", "Climatisation", "Wifi gratuit"],
      openingHours: {
        "Lundi": "Ferm√©",
        "Mardi": "19:00 - 22:00",
        "Mercredi": "19:00 - 22:00",
        "Jeudi": "19:00 - 22:00",
        "Vendredi": "19:00 - 22:30",
        "Samedi": "19:00 - 22:30",
        "Dimanche": "19:00 - 22:00"
      },
      menu: [
        {
          category: "Entr√©es",
          items: [
            { name: "Foie gras de canard", price: "32‚Ç¨", description: "Accompagn√© de son chutney de figues" },
            { name: "Saint-Jacques grill√©es", price: "28‚Ç¨", description: "Pur√©e de topinambour, truffe noire" }
          ]
        },
        {
          category: "Plats",
          items: [
            { name: "Filet de b≈ìuf", price: "45‚Ç¨", description: "Sauce aux morilles, l√©gumes de saison" },
            { name: "Omble chevalier", price: "38‚Ç¨", description: "Poisson du lac, beurre blanc aux herbes" }
          ]
        }
      ]
    },
    {
      slug: "chez-mamie-lise",
      category: "savoyard",
      name: "Chez Mamie Lise",
      description: "Sp√©cialit√©s savoyardes dans un cadre authentique",
      address: "8 Rue de la R√©publique, 74000 Annecy",
      rating: 4.2,
      priceRange: "‚Ç¨‚Ç¨",
      cuisine: "Savoyarde",
      phone: "04 50 45 67 89",
      image: "/images/restaurants/mamie-lise.jpg",
      features: ["Sp√©cialit√©s locales", "Ambiance chaleureuse", "Menu enfant", "Terrasse"],
      openingHours: {
        "Lundi": "11:30 - 14:00, 18:30 - 22:00",
        "Mardi": "11:30 - 14:00, 18:30 - 22:00",
        "Mercredi": "11:30 - 14:00, 18:30 - 22:00",
        "Jeudi": "11:30 - 14:00, 18:30 - 22:00",
        "Vendredi": "11:30 - 14:00, 18:30 - 22:30",
        "Samedi": "11:30 - 14:00, 18:30 - 22:30",
        "Dimanche": "11:30 - 14:00, 18:30 - 22:00"
      },
      menu: [
        {
          category: "Sp√©cialit√©s",
          items: [
            { name: "Fondue savoyarde", price: "22‚Ç¨", description: "Beaufort, Comt√©, Abondance" },
            { name: "Tartiflette", price: "16‚Ç¨", description: "Reblochon fermier, lardons, oignons" },
            { name: "Raclette", price: "19‚Ç¨", description: "Fromage de Savoie, charcuterie" }
          ]
        }
      ]
    },
    {
      slug: "le-petit-bouchon",
      category: "sur-le-pouce",
      name: "Le Petit Bouchon",
      description: "Sandwichs et plats rapides de qualit√©",
      address: "15 Rue Sainte-Claire, 74000 Annecy",
      rating: 4.0,
      priceRange: "‚Ç¨",
      cuisine: "Rapide",
      phone: "04 50 45 99 88",
      image: "/images/restaurants/petit-bouchon.jpg",
      features: ["Service rapide", "√Ä emporter", "Prix abordables", "Livraison"],
      openingHours: {
        "Lundi": "11:00 - 15:00",
        "Mardi": "11:00 - 15:00",
        "Mercredi": "11:00 - 15:00",
        "Jeudi": "11:00 - 15:00",
        "Vendredi": "11:00 - 15:00",
        "Samedi": "11:00 - 16:00",
        "Dimanche": "Ferm√©"
      }
    },
    {
      slug: "sakura-sushi",
      category: "cuisine-du-monde",
      name: "Sakura Sushi",
      description: "Authentique cuisine japonaise au c≈ìur d'Annecy",
      address: "25 Rue Carnot, 74000 Annecy",
      rating: 4.3,
      priceRange: "‚Ç¨‚Ç¨",
      cuisine: "Japonaise",
      phone: "04 50 45 77 66",
      image: "/images/restaurants/sakura.jpg",
      features: ["Sushi frais", "Menu v√©g√©tarien", "Livraison", "√Ä emporter"],
      openingHours: {
        "Lundi": "Ferm√©",
        "Mardi": "18:00 - 22:00",
        "Mercredi": "18:00 - 22:00",
        "Jeudi": "18:00 - 22:00",
        "Vendredi": "18:00 - 22:30",
        "Samedi": "18:00 - 22:30",
        "Dimanche": "18:00 - 22:00"
      }
    },
    {
      slug: "green-garden",
      category: "vegetarien",
      name: "Green Garden",
      description: "Restaurant 100% v√©g√©tarien avec produits biologiques locaux",
      address: "12 Avenue de France, 74000 Annecy",
      rating: 4.4,
      priceRange: "‚Ç¨‚Ç¨",
      cuisine: "V√©g√©tarienne",
      phone: "04 50 45 55 44",
      image: "/images/restaurants/green-garden.jpg",
      features: ["Bio", "Local", "Vegan options", "Terrasse", "Sans gluten"],
      openingHours: {
        "Lundi": "11:30 - 14:30, 18:30 - 21:30",
        "Mardi": "11:30 - 14:30, 18:30 - 21:30",
        "Mercredi": "11:30 - 14:30, 18:30 - 21:30",
        "Jeudi": "11:30 - 14:30, 18:30 - 21:30",
        "Vendredi": "11:30 - 14:30, 18:30 - 22:00",
        "Samedi": "11:30 - 14:30, 18:30 - 22:00",
        "Dimanche": "11:30 - 14:30"
      }
    }
  ];
  
  const paths = [];
  
  for (const localeConfig of locales) {
    for (const restaurant of restaurants) {
      paths.push({
        params: { 
          locale: localeConfig.code,
          category: restaurant.category,
          slug: restaurant.slug
        },
        props: { restaurant }
      });
    }
  }
  
  return paths;
}

const { locale, category, slug } = Astro.params;
const { restaurant } = Astro.props;
const translations = await loadTranslations(locale as Locale);

const categoryMap: Record<string, string> = {
  'gastronomique': 'Gastronomique',
  'savoyard': 'Savoyard',
  'sur-le-pouce': 'Sur le pouce',
  'cuisine-du-monde': 'Cuisine du monde',
  'vegetarien': 'V√©g√©tarien'
};

const categoryName = categoryMap[category as string] || category;
const title = `${restaurant.name} - ${categoryName} - ${t(translations, 'nav.restaurants')} - Salut Annecy`;
const description = restaurant.description;
---

<Layout 
  title={title}
  description={description}
  locale={locale as Locale}
>
  <Navigation slot="header" locale={locale as Locale} currentPath="/restaurants" />
  
  <article class="restaurant-page">
    <div class="container">
      <!-- Breadcrumb -->
      <nav class="breadcrumb">
        <a href={`/${locale}/restaurants`}>{t(translations, 'nav.restaurants')}</a>
        <span class="separator">‚Ä∫</span>
        <a href={`/${locale}/restaurants/${category}`}>{categoryName}</a>
        <span class="separator">‚Ä∫</span>
        <span class="current">{restaurant.name}</span>
      </nav>
      
      <!-- Restaurant Header -->
      <header class="restaurant-header">
        <div class="restaurant-image">
          <img src={restaurant.image} alt={restaurant.name} />
          <div class="image-overlay">
            <div class="restaurant-category">{categoryName}</div>
            <div class="restaurant-rating">
              <span class="rating-stars">‚òÖ</span>
              <span class="rating-value">{restaurant.rating}</span>
            </div>
          </div>
        </div>
        
        <div class="restaurant-info">
          <h1 class="restaurant-name">{restaurant.name}</h1>
          <p class="restaurant-description">{restaurant.description}</p>
          
          <div class="restaurant-meta">
            <div class="meta-item">
              <span class="meta-label">Cuisine:</span>
              <span class="meta-value">{restaurant.cuisine}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Prix:</span>
              <span class="meta-value">{restaurant.priceRange}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Note:</span>
              <span class="meta-value">{restaurant.rating}/5</span>
            </div>
          </div>
          
          <div class="restaurant-actions">
            {restaurant.phone && (
              <a href={`tel:${restaurant.phone}`} class="btn btn-primary">
                üìû Appeler
              </a>
            )}
            {restaurant.website && (
              <a href={restaurant.website} target="_blank" rel="noopener" class="btn btn-ghost">
                üåê Site web
              </a>
            )}
          </div>
        </div>
      </header>
      
      <!-- Restaurant Details -->
      <div class="restaurant-layout">
        <main class="restaurant-main">
          <!-- Contact Information -->
          <section class="info-section">
            <h2>Informations pratiques</h2>
            <div class="contact-grid">
              <div class="contact-item">
                <h3>üìç Adresse</h3>
                <p>{restaurant.address}</p>
              </div>
              {restaurant.phone && (
                <div class="contact-item">
                  <h3>üìû T√©l√©phone</h3>
                  <p><a href={`tel:${restaurant.phone}`}>{restaurant.phone}</a></p>
                </div>
              )}
              {restaurant.email && (
                <div class="contact-item">
                  <h3>‚úâÔ∏è Email</h3>
                  <p><a href={`mailto:${restaurant.email}`}>{restaurant.email}</a></p>
                </div>
              )}
              {restaurant.website && (
                <div class="contact-item">
                  <h3>üåê Site web</h3>
                  <p><a href={restaurant.website} target="_blank" rel="noopener">Visiter le site</a></p>
                </div>
              )}
            </div>
          </section>
          
          <!-- Features -->
          <section class="info-section">
            <h2>Services et √©quipements</h2>
            <div class="features-grid">
              {restaurant.features.map((feature) => (
                <div class="feature-item">
                  <span class="feature-icon">‚úì</span>
                  <span class="feature-text">{feature}</span>
                </div>
              ))}
            </div>
          </section>
          
          <!-- Opening Hours -->
          {restaurant.openingHours && (
            <section class="info-section">
              <h2>Horaires d'ouverture</h2>
              <div class="hours-grid">
                {Object.entries(restaurant.openingHours).map(([day, hours]) => (
                  <div class="hours-item">
                    <span class="day">{day}</span>
                    <span class={`hours ${hours === 'Ferm√©' ? 'closed' : ''}`}>{hours}</span>
                  </div>
                ))}
              </div>
            </section>
          )}
          
          <!-- Menu -->
          {restaurant.menu && (
            <section class="info-section">
              <h2>Menu</h2>
              <div class="menu-sections">
                {restaurant.menu.map((section) => (
                  <div class="menu-section">
                    <h3 class="menu-category">{section.category}</h3>
                    <div class="menu-items">
                      {section.items.map((item) => (
                        <div class="menu-item">
                          <div class="item-header">
                            <span class="item-name">{item.name}</span>
                            <span class="item-price">{item.price}</span>
                          </div>
                          {item.description && (
                            <p class="item-description">{item.description}</p>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}
        </main>
        
        <!-- Sidebar -->
        <aside class="restaurant-sidebar">
          <div class="sidebar-widget card">
            <div class="card-body">
              <h3 class="widget-title">Navigation</h3>
              <div class="nav-links">
                <a href={`/${locale}/restaurants/${category}`} class="nav-link">
                  ‚Üê Retour √† {categoryName}
                </a>
                <a href={`/${locale}/restaurants`} class="nav-link">
                  Tous les restaurants
                </a>
              </div>
            </div>
          </div>
          
          <div class="sidebar-widget card">
            <div class="card-body">
              <h3 class="widget-title">Actions rapides</h3>
              <div class="quick-actions">
                {restaurant.phone && (
                  <a href={`tel:${restaurant.phone}`} class="quick-action">
                    üìû Appeler directement
                  </a>
                )}
                <button class="quick-action" onclick="shareRestaurant()">
                  üì§ Partager
                </button>
                <button class="quick-action" onclick="addToFavorites()">
                  ‚ù§Ô∏è Ajouter aux favoris
                </button>
              </div>
            </div>
          </div>
          
          {restaurant.features.includes("R√©servation recommand√©e") && (
            <div class="sidebar-widget card reservation-widget">
              <div class="card-body">
                <h3 class="widget-title">R√©servation</h3>
                <p>Ce restaurant recommande de r√©server √† l'avance.</p>
                {restaurant.phone && (
                  <a href={`tel:${restaurant.phone}`} class="btn btn-primary btn-block">
                    R√©server par t√©l√©phone
                  </a>
                )}
              </div>
            </div>
          )}
        </aside>
      </div>
    </div>
  </article>
</Layout>

<script>
  function shareRestaurant() {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      });
    } else {
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert('Lien copi√© dans le presse-papiers!');
      });
    }
  }
  
  function addToFavorites() {
    // In a real app, this would save to user preferences
    alert('Restaurant ajout√© aux favoris!');
  }
</script>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 2rem 0 1rem 0;
    font-size: 0.875rem;
    color: #6b7280;
  }

  .breadcrumb a {
    color: #8b5cf6;
    text-decoration: none;
  }

  .breadcrumb a:hover {
    text-decoration: underline;
  }

  .separator {
    color: #d1d5db;
  }

  .current {
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
  }

  .restaurant-header {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 3rem;
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 2rem;
  }

  .restaurant-image {
    position: relative;
    border-radius: 0.75rem;
    overflow: hidden;
    height: 300px;
  }

  .restaurant-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.3));
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1rem;
  }

  .restaurant-category {
    background: #8b5cf6;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .restaurant-rating {
    background: rgba(255, 255, 255, 0.9);
    color: #111827;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .rating-stars {
    color: #fbbf24;
  }

  .restaurant-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .restaurant-name {
    font-size: 2.5rem;
    font-weight: 700;
    color: #111827;
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .restaurant-description {
    font-size: 1.25rem;
    color: #6b7280;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .restaurant-meta {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .meta-item {
    text-align: center;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
  }

  .meta-label {
    display: block;
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
  }

  .meta-value {
    display: block;
    font-weight: 600;
    color: #111827;
  }

  .restaurant-actions {
    display: flex;
    gap: 1rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.5rem;
    border-radius: 0.375rem;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
    border: none;
    cursor: pointer;
  }

  .btn-primary {
    background: #8b5cf6;
    color: white;
  }

  .btn-primary:hover {
    background: #7c3aed;
  }

  .btn-ghost {
    background: transparent;
    color: #8b5cf6;
    border: 1px solid #8b5cf6;
  }

  .btn-ghost:hover {
    background: #8b5cf6;
    color: white;
  }

  .btn-block {
    width: 100%;
  }

  .restaurant-layout {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 2rem;
    margin-bottom: 4rem;
  }

  .info-section {
    margin-bottom: 3rem;
  }

  .info-section h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #8b5cf6;
  }

  .contact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .contact-item h3 {
    font-size: 1rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .contact-item p {
    color: #6b7280;
  }

  .contact-item a {
    color: #8b5cf6;
    text-decoration: none;
  }

  .contact-item a:hover {
    text-decoration: underline;
  }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .feature-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 0.5rem;
  }

  .feature-icon {
    color: #059669;
    font-weight: 600;
  }

  .feature-text {
    color: #374151;
  }

  .hours-grid {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .hours-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 0.375rem;
  }

  .day {
    font-weight: 500;
    color: #374151;
  }

  .hours {
    color: #059669;
    font-weight: 500;
  }

  .hours.closed {
    color: #dc2626;
  }

  .menu-sections {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .menu-section {
    background: #f9fafb;
    border-radius: 0.75rem;
    padding: 1.5rem;
  }

  .menu-category {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #d1d5db;
  }

  .menu-items {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .menu-item {
    background: white;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  }

  .item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .item-name {
    font-weight: 600;
    color: #111827;
  }

  .item-price {
    font-weight: 600;
    color: #059669;
  }

  .item-description {
    color: #6b7280;
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .restaurant-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .sidebar-widget {
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  }

  .card-body {
    padding: 1.5rem;
  }

  .widget-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 1rem;
  }

  .nav-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .nav-link {
    color: #8b5cf6;
    text-decoration: none;
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.2s;
  }

  .nav-link:hover {
    background: #f3f4f6;
  }

  .quick-actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .quick-action {
    background: none;
    border: 1px solid #d1d5db;
    color: #374151;
    padding: 0.75rem;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: block;
    text-align: center;
  }

  .quick-action:hover {
    background: #f9fafb;
    border-color: #8b5cf6;
    color: #8b5cf6;
  }

  .reservation-widget {
    background: linear-gradient(135deg, #fef3c7, #fbbf24);
  }

  .reservation-widget .widget-title {
    color: #92400e;
  }

  .reservation-widget p {
    color: #92400e;
    margin-bottom: 1rem;
  }

  @media (max-width: 768px) {
    .restaurant-header {
      grid-template-columns: 1fr;
      text-align: center;
    }
    
    .restaurant-layout {
      grid-template-columns: 1fr;
    }
    
    .restaurant-name {
      font-size: 2rem;
    }
    
    .restaurant-meta {
      grid-template-columns: 1fr;
    }
    
    .restaurant-actions {
      flex-direction: column;
    }
    
    .contact-grid {
      grid-template-columns: 1fr;
    }
    
    .features-grid {
      grid-template-columns: 1fr;
    }
    
    .current {
      max-width: 150px;
    }
  }
</style>